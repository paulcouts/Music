<!DOCTYPE html>
<html>
<head>
  <title>Music App</title>
  <!-- Link to your CSS in the static folder -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    /* iOS-like overall look */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f2f2f2;
      color: #333;
    }

    /* Top navigation bar for search */
    .top-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #ffffff;
      padding: 10px 15px;
      border-bottom: 1px solid #ccc;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .top-nav input[type="text"] {
      flex: 1;
      max-width: 600px;
      padding: 8px 10px;
      margin-right: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .top-nav button {
      background-color: #007aff;
      border: none;
      color: #fff;
      padding: 8px 16px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Container for recommended boxes */
    .home-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 80px 0; /* space for the top and bottom bars */
      padding: 10px;
      gap: 10px;
    }

    /* Each box for recommended songs/categories */
    .home-box {
      background-color: #fff;
      width: calc(33% - 20px);
      max-width: 200px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      cursor: pointer;
    }

    .home-box img {
      width: 100%;
      display: block;
    }

    .home-box .box-info {
      padding: 10px;
    }
    
    .home-box .box-info h3 {
      font-size: 16px;
      margin: 5px 0;
    }

    /* Player bar at bottom of screen */
    .player-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #fff;
      border-top: 1px solid #ccc;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 0 10px;
      z-index: 999;
    }

    /* Hide the actual video visually but allow YouTube controls to persist */
    #hidden-video {
      position: absolute;
      width: 1px; 
      height: 1px; 
      opacity: 0;
      pointer-events: none;
    }
  </style>

</head>
<body>

  <!-- Top nav with search -->
  <div class="top-nav">
    <input type="text" id="searchInput" placeholder="Search songs or artists..." />
    <button onclick="searchVideos()">Search</button>
  </div>

  <!-- Home screen with recommended songs/categories -->
  <div class="home-container">
    <!-- Example: 6 boxes for recommended items -->
    <div class="home-box" onclick="playSong('VIDEO_ID_1', 'Song Title 1')">
      <img src="https://via.placeholder.com/300?text=Thumb1" alt="Thumb1">
      <div class="box-info">
        <h3>Song Title 1</h3>
        <p>Artist Name</p>
      </div>
    </div>

    <div class="home-box" onclick="playSong('VIDEO_ID_2', 'Song Title 2')">
      <img src="https://via.placeholder.com/300?text=Thumb2" alt="Thumb2">
      <div class="box-info">
        <h3>Song Title 2</h3>
        <p>Artist Name</p>
      </div>
    </div>

    <div class="home-box" onclick="playSong('VIDEO_ID_3', 'Song Title 3')">
      <img src="https://via.placeholder.com/300?text=Thumb3" alt="Thumb3">
      <div class="box-info">
        <h3>Song Title 3</h3>
        <p>Artist Name</p>
      </div>
    </div>

    <div class="home-box" onclick="playSong('VIDEO_ID_4', 'Song Title 4')">
      <img src="https://via.placeholder.com/300?text=Thumb4" alt="Thumb4">
      <div class="box-info">
        <h3>Song Title 4</h3>
        <p>Artist Name</p>
      </div>
    </div>

    <div class="home-box" onclick="playSong('VIDEO_ID_5', 'Song Title 5')">
      <img src="https://via.placeholder.com/300?text=Thumb5" alt="Thumb5">
      <div class="box-info">
        <h3>Song Title 5</h3>
        <p>Artist Name</p>
      </div>
    </div>

    <div class="home-box" onclick="playSong('VIDEO_ID_6', 'Song Title 6')">
      <img src="https://via.placeholder.com/300?text=Thumb6" alt="Thumb6">
      <div class="box-info">
        <h3>Song Title 6</h3>
        <p>Artist Name</p>
      </div>
    </div>
  </div>

  <!-- Hidden video to let YouTube stream audio -->
  <div id="hidden-video"></div>

  <!-- Bottom player bar -->
  <div class="player-bar">
    <div id="songTitle">Not playing</div>
    <!-- A simple progress bar (update via YouTube API if desired) -->
    <input type="range" id="progressBar" value="0" min="0" max="100" style="width: 40%;">
    <button onclick="togglePlayPause()">Play/Pause</button>
  </div>

  <!-- Load YouTube IFrame API and define functions -->
  <script>
    let player;
    let isPlaying = false;

    function loadYouTubeAPI() {
      let tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      let firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }

    window.onYouTubeIframeAPIReady = function() {
      // Create the player in the hidden div
      player = new YT.Player('hidden-video', {
        height: '90',
        width: '160',
        videoId: '',
        playerVars: {
          controls: 1,
          autoplay: 0,
          modestbranding: 1,
          showinfo: 0,
          rel: 0
        },
        events: {
          'onStateChange': onPlayerStateChange
        }
      });
    };

    function onPlayerStateChange(event) {
      if(event.data === YT.PlayerState.ENDED) {
        console.log('Song ended');
      }
    }

    // Function to play a song from a recommended box
    function playSong(videoId, title) {
      if(player) {
        player.loadVideoById(videoId);
        document.getElementById('songTitle').textContent = title;
        isPlaying = true;
      }
    }

    function togglePlayPause() {
      if(!player) return;
      if(isPlaying) {
        player.pauseVideo();
        isPlaying = false;
      } else {
        player.playVideo();
        isPlaying = true;
      }
    }

    async function searchVideos() {
      const query = document.getElementById('searchInput').value.trim();
      if(!query) return;

      try {
        const response = await fetch('/search', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: 'query=' + encodeURIComponent(query)
        });
        const data = await response.json();
        console.log(data);
        // Optionally update the UI with search results.
      } catch (err) {
        console.error(err);
      }
    }

    // Load the YouTube API on page load.
    loadYouTubeAPI();
  </script>
</body>
</html>
